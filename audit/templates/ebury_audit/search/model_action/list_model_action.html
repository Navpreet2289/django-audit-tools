<%
function twoDigits(n) {
  return (n > 9 ? n : '0' + n);
};

if (data.length > 0) {
%>
<div class="panel-group" id="panel_result_list">
  <div class="row result-header">
    <div class="col-xs-3">
      <h4>Model</h4>
    </div>
    <div class="col-xs-2">
      <h4>ID</h4>
    </div>
    <div class="col-xs-2">
      <h4>Action</h4>
    </div>
    <div class="col-xs-5">
      <h4>Date</h4>
    </div>
  </div>
  <%
  var i = 0;
  $.each(data, function() {
    var label_class = "label ";
    if (this.action == 'create') {
      label_class += 'label-success';
    } else if (this.action == 'update') {
      label_class += 'label-warning';
    } else {
      label_class += 'label-danger';
    }
    var id = "list_item_" + i;
    var parent_detail_id = "panel_result_detail_" + i;
    var detail_id = "detail_item_" + i;
  %>
  <div class="panel panel-default">
    <div class="panel-heading" data-toggle="collapse" data-target="#<%- id %>">
      <div class="panel-title row">
        <%
        var d = new Date(this.timestamp.$date);
        var day = twoDigits(d.getUTCDate());
        var month = twoDigits(d.getUTCMonth() + 1);
        var hours = twoDigits(d.getUTCHours());
        var minutes = twoDigits(d.getUTCMinutes());
        var seconds = twoDigits(d.getUTCSeconds());
        var strTimestamp = day + '/' + month + '/' + d.getFullYear() + ' - ' + hours + ':' + minutes + ':' + seconds + ' (UTC)';
        %>
        <div class="col-xs-3">
          <h4><%= this.model.name %></h4>
        </div>
        <div class="col-xs-2">
          <h4><%= this.instance.id %></h4>
        </div>
        <div class="col-xs-2">
          <h4><span class="<%- label_class %>"><%= this.action %></span></h4>
        </div>
        <div class="col-xs-5">
          <h4><%= strTimestamp %></h4>
        </div>
      </div>
    </div>
    <div id="<%- id %>" class="panel-collapse collapse out">
      <div class="panel-body">
        <ul class="nav nav-tabs nav-justified" role="tablist">
          <li class="active"><a data-target="#<%- detail_id %>" class="changes_tab" role="tab" data-toggle="tab">Changes</a></li>
          <li><a data-target="#<%- detail_id %>" class="detail_tab" role="tab" data-toggle="tab">Detail</a></li>
          <li><a data-target="#<%- detail_id %>" class="access_tab" role="tab" data-toggle="tab">Access</a></li>
          <li><a data-target="#<%- detail_id %>" class="process_tab" role="tab" data-toggle="tab">Process</a></li>
        </ul>
        <div class="tab-content">
          <div id="<%- detail_id %>" class="tab-pane active"></div>
        </div>
      </div>
    </div>
  </div>
  <%
  i += 1;
  });
  %>
  <div class="row text-center">
    <ul class="pagination">
      <li><a href="#" data-page="1">&laquo;</a></li>
      <%
      var num_pages = paginator.last;
      var current = paginator.page;
      var first = (current <= 5) ? 1 : current-5;
      var last = (current > (num_pages-5)) ? num_pages : current+5;
      last = (last == 0) ? 1 : last;
      for (var i = first; i <= last; i++) {
        if (i != current) {
      %>
      <li><a href="#" data-page="<%- i %>"><%= i %></a></li>
      <% } else { %>
      <li class="active"><a href="#" data-page="<%- i %>"><%= i %></a></li>
      <% }}; %>
      <li><a href="#" data-page="<%- num_pages %>">&raquo;</a></li>
    </ul>
  </div>
</div>
<% } else { %>
<div id="result_error">
  <h4>Search not found any result.</h4>
</div>
<% } %>